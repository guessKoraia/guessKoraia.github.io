<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>í•œêµ­ì¸ê³µì§€ëŠ¥í˜‘íšŒ | ë¸”ë¡œê·¸</title>
<meta name="description" content="í•œêµ­ì¸ê³µì§€ëŠ¥í˜‘íšŒ íšŒì›ì‚¬ íƒë°©ê¸°ì™€ í–‰ì‚¬ í˜„ì¥ ê¸°ë¡ì„ ë§Œë‚˜ë³´ì„¸ìš”." />

<link rel="icon" href="https://koraia.org/default/img/symbol.ico" />
<link rel="shortcut icon" href="https://koraia.org/default/img/symbol.ico" />
<link rel="apple-touch-icon" sizes="180x180" href="https://raw.githubusercontent.com/koraia-trend/koraia-trend.github.io/refs/heads/main/koraia_circle_icon_2.png" />
<link rel="icon" type="image/png" sizes="192x192" href="https://raw.githubusercontent.com/koraia-trend/koraia-trend.github.io/refs/heads/main/koraia_circle_icon_2.png" />

<meta property="og:type" content="article" />
<meta property="og:title" id="ogTitle" content="í•œêµ­ì¸ê³µì§€ëŠ¥í˜‘íšŒ | ë¸”ë¡œê·¸" />
<meta property="og:description" id="ogDesc" content="í•œêµ­ì¸ê³µì§€ëŠ¥í˜‘íšŒ íšŒì›ì‚¬ íƒë°©ê¸°ì™€ í–‰ì‚¬ í˜„ì¥ ê¸°ë¡ì„ ë§Œë‚˜ë³´ì„¸ìš”." />
<meta property="og:image" id="ogImage" content="https://raw.githubusercontent.com/guessKoraia/guessKoraia.github.io/refs/heads/main/koraia_main_popup/koraia_blog.png" />
<meta property="og:url" id="ogUrl" content="https://guesskoraia.github.io/blog_post.html" />
<meta property="og:locale" content="ko_KR" />
<meta property="og:site_name" content="í•œêµ­ì¸ê³µì§€ëŠ¥í˜‘íšŒ" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" id="twTitle" content="í•œêµ­ì¸ê³µì§€ëŠ¥í˜‘íšŒ | ë¸”ë¡œê·¸" />
<meta name="twitter:description" id="twDesc" content="í•œêµ­ì¸ê³µì§€ëŠ¥í˜‘íšŒ íšŒì›ì‚¬ íƒë°©ê¸°ì™€ í–‰ì‚¬ í˜„ì¥ ê¸°ë¡ì„ ë§Œë‚˜ë³´ì„¸ìš”." />
<meta name="twitter:image" id="twImage" content="https://raw.githubusercontent.com/guessKoraia/guessKoraia.github.io/refs/heads/main/koraia_main_popup/koraia_blog.png" />

<link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin />
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard/dist/web/pretendardvariable.css" />
<style>
  * { margin: 0; padding: 0; box-sizing: border-box; }
  body {
    font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: #fff;
    color: #222;
    line-height: 1.7;
    max-width: 900px;
    margin: 0 auto;
    padding: 16px;
  }

  /* ë’¤ë¡œê°€ê¸° */
  .back-link {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    color: #1a73e8;
    text-decoration: none;
    font-size: 0.85rem;
    margin-bottom: 20px;
    padding: 6px 0;
  }
  .back-link:hover { text-decoration: underline; }

  /* ë¡œë”© */
  .loading {
    text-align: center;
    padding: 80px 0;
    color: #888;
    font-size: 0.9rem;
  }
  .loading .spinner {
    display: inline-block;
    width: 28px; height: 28px;
    border: 3px solid #e0e0e0;
    border-top-color: #1a73e8;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
    margin-bottom: 10px;
  }
  @keyframes spin { to { transform: rotate(360deg); } }

  /* ì—ëŸ¬ */
  .error-state {
    text-align: center;
    padding: 80px 0;
    color: #999;
  }
  .error-state .icon { font-size: 2.5rem; margin-bottom: 10px; }

  /* íƒ€ì… ë±ƒì§€ */
  .post-type-badge {
    display: inline-block;
    font-size: 0.72rem;
    font-weight: 600;
    padding: 3px 10px;
    border-radius: 12px;
    margin-bottom: 8px;
  }
  .post-type-badge.event { background: #e8f0fe; color: #1a73e8; }
  .post-type-badge.visit { background: #fef7e0; color: #e8a800; }

  /* ì œëª© */
  .post-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #111;
    line-height: 1.4;
    margin-bottom: 12px;
    letter-spacing: -0.02em;
  }

  /* ë©”íƒ€ ì •ë³´ */
  .post-meta-bar {
    display: flex;
    flex-wrap: wrap;
    gap: 14px;
    font-size: 0.82rem;
    color: #777;
    padding-bottom: 16px;
    border-bottom: 1px solid #eee;
    margin-bottom: 24px;
  }
  .post-meta-bar span {
    display: flex;
    align-items: center;
    gap: 4px;
  }

  /* ì¸ë„¤ì¼ */
  .post-hero {
    width: 100%;
    max-height: 400px;
    object-fit: cover;
    border-radius: 10px;
    margin-bottom: 24px;
  }

  /* ë³¸ë¬¸ â€” TinyMCE content_style ì™„ì „ ë™ê¸°í™” */
  .post-body {
    font-family: Pretendard, Pretendard Variable, system-ui, -apple-system, 'Segoe UI', Roboto, 'Noto Sans KR', Arial, sans-serif;
    font-size: 14px;
    line-height: 1.7;
    color: #111827;
    word-break: keep-all;
    overflow-wrap: break-word;
  }
  .post-body h1 { font-size: 26px; font-weight: 800; margin: 0 0 12px 0; color: #111827; }
  .post-body h2 { font-size: 18px; font-weight: 800; margin: 18px 0 10px 0; color: #111827; }
  .post-body h3 { font-size: 16px; font-weight: 700; margin: 16px 0 8px 0; color: #111827; }
  .post-body h4 { font-size: 14px; font-weight: 600; margin: 14px 0 6px 0; color: #111827; }
  .post-body h5 { font-size: 12px; font-weight: 500; margin: 12px 0 4px 0; color: #111827; }
  .post-body p { margin: 10px 0; line-height: 1.7; }
  .post-body strong { font-weight: 700; }
  .post-body em { font-style: italic; }
  .post-body u { text-decoration: underline; }
  .post-body ul, .post-body ol { margin: 10px 0; padding-left: 20px; }
  .post-body li { margin: 5px 0; }
  .post-body blockquote {
    background-color: #f9fafb;
    border: 1px solid #d1d5db;
    border-left: 3px solid #6b7280;
    padding: 16px 20px;
    margin: 20px 0;
    font-style: normal;
    color: #111827;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  /* ì±„íŒ…í˜• ë§í’ì„  (blockquote-type5: ì™¼ìª½, blockquote-type6: ì˜¤ë¥¸ìª½) */
  .post-body .blockquote-type5 {
    width: fit-content; min-width: 48px; max-width: min(520px, calc(100% - 28px));
    margin-left: 0; margin-right: auto;
    padding: 10px 16px; border-radius: 24px;
    background-color: #f3f4f6; color: #374151;
    border: none; box-shadow: none; border-left: none;
  }
  .post-body .blockquote-type6 {
    width: fit-content; min-width: 48px; max-width: min(520px, calc(100% - 28px));
    margin-left: auto; margin-right: 0;
    padding: 10px 16px; border-radius: 24px;
    background-color: #2563eb; color: #ffffff;
    border: none; box-shadow: none; border-left: none;
  }
  .post-body table {
    margin-bottom: 30px; width: 100%; text-align: left;
    color: #3f3f3f; border-collapse: collapse; border: 1px solid #e8e8e8;
  }
  .post-body table tr:nth-child(odd):not(:first-child) { background-color: #f7f7f7; }
  .post-body table td:first-child { background-color: transparent !important; }
  .post-body table th, .post-body table td { padding: 10px 15px; }
  .post-body table th {
    background-color: #f3f4f6; font-weight: 600;
    border: 1px solid #dedede; border-bottom-color: #c9c9c9;
  }
  .post-body table td { border: 1px solid #e8e8e8; }
  .post-body img { max-width: 100%; height: auto; border-radius: 4px; }
  .post-body a { color: #2563eb; text-decoration: none; }
  .post-body a:hover { text-decoration: underline; }
  .post-body hr { border: 0; border-top: 1px solid #e5e7eb; margin: 20px 0; }
  .post-body p[style*="text-align: center"] { text-align: center; }
  .post-body p[style*="text-align: right"] { text-align: right; }
  .post-body p[style*="text-align: justify"] { text-align: justify; }
  /* Q&A ë¸”ë¡ */
  .post-body .qa-item {
    background-color: #f9fafb; border: 1px solid #d1d5db;
    border-left: 3px solid #6b7280; padding: 16px 20px;
    margin: 20px 0; font-style: normal; color: #111827;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
  }
  .post-body .qa-item strong { color: #3b82f6; font-weight: 700; }
  .post-body .qa-item .qa-answer { color: #374151; }
  .post-body .qa-label { font-size: 16px; font-weight: bold; margin-right: 4px; }
  .post-body .qa-q { color: #3b82f6; }
  .post-body .qa-a { color: #10b981; }

  /* â”€â”€ ê°¤ëŸ¬ë¦¬ â”€â”€ */
  .img-gallery { margin: 20px 0; border: 1px solid #e8e8e8; border-radius: 10px; overflow: hidden; }
  .gallery-toolbar {
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 12px; background: #f9fafb; border-bottom: 1px solid #e8e8e8; font-size: 0.78rem; color: #666;
  }
  .gallery-toolbar .gallery-count { font-weight: 600; }
  .gallery-modes { display: flex; gap: 4px; }
  .gallery-modes button {
    padding: 4px 10px; border: 1px solid #ddd; border-radius: 6px;
    background: #fff; color: #555; font-size: 0.72rem; cursor: pointer; transition: all 0.2s;
  }
  .gallery-modes button:hover { border-color: #1a73e8; color: #1a73e8; }
  .gallery-modes button.active { background: #1a73e8; color: #fff; border-color: #1a73e8; }

  /* ìŠ¬ë¼ì´ë“œ ë·° */
  .gallery-slide { position: relative; background: #000; min-height: 200px; }
  .gallery-slide .slide-track {
    display: flex; overflow-x: auto; scroll-snap-type: x mandatory;
    scrollbar-width: none; -ms-overflow-style: none;
  }
  .gallery-slide .slide-track::-webkit-scrollbar { display: none; }
  .gallery-slide .slide-item {
    flex: 0 0 100%; scroll-snap-align: center;
    display: flex; align-items: center; justify-content: center;
    max-height: 500px; min-height: 200px;
  }
  .gallery-slide .slide-item img {
    max-width: 100%; max-height: 500px; object-fit: contain; cursor: zoom-in;
  }
  .slide-nav {
    position: absolute; top: 50%; transform: translateY(-50%);
    width: 36px; height: 36px; border-radius: 50%; border: none;
    background: rgba(255,255,255,0.85); color: #333; font-size: 1rem;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15); z-index: 2; transition: opacity 0.2s;
  }
  .slide-nav:hover { background: #fff; }
  .slide-nav.prev { left: 8px; }
  .slide-nav.next { right: 8px; }
  .slide-dots {
    display: flex; justify-content: center; gap: 6px; padding: 10px;
    background: #f9fafb; border-top: 1px solid #e8e8e8;
  }
  .slide-dots span {
    width: 8px; height: 8px; border-radius: 50%; background: #ccc;
    cursor: pointer; transition: background 0.2s;
  }
  .slide-dots span.active { background: #1a73e8; }

  /* ê·¸ë¦¬ë“œ ë·° */
  .gallery-grid {
    display: grid; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 4px; padding: 4px;
  }
  .gallery-grid img {
    width: 100%; aspect-ratio: 1; object-fit: cover; cursor: zoom-in;
    border-radius: 4px; transition: opacity 0.2s;
  }
  .gallery-grid img:hover { opacity: 0.85; }

  /* ë¦¬ìŠ¤íŠ¸ ë·° */
  .gallery-list { display: flex; flex-direction: column; gap: 8px; padding: 8px; }
  .gallery-list-item {
    display: flex; gap: 12px; align-items: flex-start;
    padding: 8px; background: #fafafa; border-radius: 8px;
  }
  .gallery-list-item img {
    width: 160px; height: 110px; object-fit: cover; border-radius: 6px;
    flex-shrink: 0; cursor: zoom-in;
  }
  .gallery-list-item .img-alt { font-size: 0.82rem; color: #555; padding-top: 4px; }

  /* ë¼ì´íŠ¸ë°•ìŠ¤ */
  .lightbox-overlay {
    position: fixed; inset: 0; background: rgba(0,0,0,0.95);
    display: none; align-items: center; justify-content: center;
    z-index: 9999; cursor: zoom-out; padding: 8px;
  }
  .lightbox-overlay.show { display: flex; }
  .lightbox-overlay img {
    width: 96vw; height: 96vh; object-fit: contain;
    border-radius: 4px; cursor: default;
    user-select: none; -webkit-user-select: none;
  }
  .lightbox-close {
    position: absolute; top: 16px; right: 20px;
    background: none; border: none; color: #fff; font-size: 2rem;
    cursor: pointer; z-index: 10;
  }
  .lightbox-counter {
    position: absolute; bottom: 16px; left: 50%; transform: translateX(-50%);
    color: rgba(255,255,255,0.8); font-size: 0.9rem; font-weight: 500;
    background: rgba(0,0,0,0.4); padding: 4px 14px; border-radius: 20px;
  }
  .lightbox-nav {
    position: absolute; top: 50%; transform: translateY(-50%);
    background: rgba(255,255,255,0.25); border: none; color: #fff;
    width: 48px; height: 48px; border-radius: 50%; font-size: 1.3rem;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    transition: background 0.2s;
  }
  .lightbox-nav:hover { background: rgba(255,255,255,0.45); }
  .lightbox-nav.prev { left: 16px; }
  .lightbox-nav.next { right: 16px; }

  @media (max-width: 600px) {
    .gallery-grid { grid-template-columns: repeat(2, 1fr); }
    .gallery-list-item img { width: 100px; height: 70px; }
    .gallery-list-item { gap: 8px; }
  }

  /* í•˜ë‹¨ êµ¬ë¶„ */
  .post-footer {
    margin-top: 40px;
    padding-top: 20px;
    border-top: 1px solid #eee;
    text-align: center;
  }
  .post-footer a {
    display: inline-block;
    padding: 10px 28px;
    background: #1a73e8;
    color: #fff;
    text-decoration: none;
    border-radius: 8px;
    font-size: 0.85rem;
    transition: background 0.2s;
  }
  .post-footer a:hover { background: #1557b0; }

  /* ë°˜ì‘í˜• */
  @media (max-width: 600px) {
    body { padding: 12px; }
    .post-title { font-size: 1.25rem; }
    .post-body { font-size: 0.9rem; }
  }
</style>
</head>
<body>

<a class="back-link" href="blog">â† ëª©ë¡ìœ¼ë¡œ</a>
<div id="content"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script src="js/supabase-config.js"></script>
<script>
(function () {
  var client = null;

  function getClient() {
    if (client) return client;
    var url = window.SUPABASE_URL;
    var key = window.SUPABASE_ANON_KEY;
    if (!url || !key || url.indexOf('__') !== -1 || key.indexOf('__') !== -1) return null;
    client = supabase.createClient(url, key);
    return client;
  }

  function formatDate(dateStr) {
    if (!dateStr) return '';
    var d = new Date(dateStr);
    if (isNaN(d)) return dateStr;
    return d.getFullYear() + '.' + String(d.getMonth() + 1).padStart(2, '0') + '.' + String(d.getDate()).padStart(2, '0');
  }

  function typeLabel(type) {
    if (type === 'event') return 'í–‰ì‚¬';
    if (type === 'visit') return 'íƒë°©';
    return type || '';
  }

  function stripHtml(html) {
    if (!html) return '';
    var tmp = document.createElement('div');
    tmp.innerHTML = html;
    return (tmp.textContent || tmp.innerText || '').replace(/\s+/g, ' ').trim();
  }

  function getPostId() {
    var params = new URLSearchParams(window.location.search);
    return params.get('id');
  }

  function showLoading() {
    document.getElementById('content').innerHTML =
      '<div class="loading"><div class="spinner"></div><br>ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘â€¦</div>';
  }

  function showError(msg) {
    document.getElementById('content').innerHTML =
      '<div class="error-state"><div class="icon">ğŸ˜¥</div><p>' + (msg || 'ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.') + '</p></div>';
  }

  /** ë³¸ë¬¸ HTMLì—ì„œ ì²« ë²ˆì§¸ img src ì¶”ì¶œ + í•´ë‹¹ img ì œê±°í•œ HTML ë°˜í™˜ */
  function extractFirstImage(editorHtml) {
    if (!editorHtml) return { src: null, html: editorHtml };
    var wrap = document.createElement('div');
    wrap.innerHTML = editorHtml;
    var firstImg = wrap.querySelector('img');
    if (!firstImg) return { src: null, html: editorHtml };
    var src = firstImg.getAttribute('src') || null;
    // ì´ë¯¸ì§€ê°€ ë‹¨ë… p/div ì•ˆì— ìˆìœ¼ë©´ ë¶€ëª¨ì§¸ ì œê±°, ì•„ë‹ˆë©´ imgë§Œ ì œê±°
    var parent = firstImg.parentElement;
    if (parent && parent !== wrap && parent.children.length === 1 &&
        (parent.tagName === 'P' || parent.tagName === 'DIV')) {
      parent.remove();
    } else {
      firstImg.remove();
    }
    return { src: src, html: wrap.innerHTML };
  }

  function renderPost(post) {
    var html = '';
    var extracted = extractFirstImage(post.editor_html || '');
    var heroSrc = extracted.src; // ë³¸ë¬¸ ì²« ì´ë¯¸ì§€ë¥¼ íˆì–´ë¡œë¡œ ì‚¬ìš©
    var bodyHtml = extracted.html;

    // íƒ€ì… ë±ƒì§€
    html += '<span class="post-type-badge ' + (post.type || '') + '">' + typeLabel(post.type) + '</span>';

    // ì œëª©
    html += '<h1 class="post-title">' + (post.title || 'ì œëª© ì—†ìŒ') + '</h1>';

    // ë©”íƒ€ ì •ë³´
    html += '<div class="post-meta-bar">';
    html += '<span>âœï¸ ' + (post.author_name || 'ìµëª…') + '</span>';
    html += '<span>ğŸ“… ' + formatDate(post.date || post.created_at) + '</span>';
    if (post.place) html += '<span>ğŸ“ ' + post.place + '</span>';
    html += '</div>';

    // íˆì–´ë¡œ ì´ë¯¸ì§€: ë³¸ë¬¸ ì²« ì´ë¯¸ì§€ â†’ ì—†ìœ¼ë©´ thumbnail_url í´ë°±
    var finalHero = heroSrc || post.thumbnail_url;
    if (finalHero) {
      html += '<img class="post-hero" src="' + finalHero + '" alt="">';
    }

    // ë³¸ë¬¸ (ì²« ì´ë¯¸ì§€ëŠ” ì´ë¯¸ ì¶”ì¶œë˜ì–´ ì œê±°ë¨)
    html += '<div class="post-body">' + (bodyHtml || '<p>ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.</p>') + '</div>';

    // í•˜ë‹¨
    html += '<div class="post-footer"><a href="blog">â† ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a></div>';

    document.getElementById('content').innerHTML = html;

    // ì—°ì† ì´ë¯¸ì§€ â†’ ê°¤ëŸ¬ë¦¬ ë³€í™˜
    convertConsecutiveImages();

    // í˜ì´ì§€ íƒ€ì´í‹€ & OG íƒœê·¸ ë™ì  ì—…ë°ì´íŠ¸
    if (post.title) {
      var fullTitle = post.title + ' - í•œêµ­ì¸ê³µì§€ëŠ¥í˜‘íšŒ ë¸”ë¡œê·¸';
      document.title = fullTitle;
      var setMeta = function(id, val) { var el = document.getElementById(id); if (el) el.setAttribute('content', val); };
      setMeta('ogTitle', fullTitle);
      setMeta('twTitle', fullTitle);
      // OG ì´ë¯¸ì§€: ë³¸ë¬¸ ì²« ì´ë¯¸ì§€ â†’ thumbnail_url í´ë°±
      var ogImg = heroSrc || post.thumbnail_url;
      if (ogImg) { setMeta('ogImage', ogImg); setMeta('twImage', ogImg); }
      var desc = stripHtml(post.editor_html || '');
      if (desc.length > 120) desc = desc.substring(0, 120) + 'â€¦';
      if (desc) { setMeta('ogDesc', desc); setMeta('twDesc', desc); }
      setMeta('ogUrl', location.href);
    }
  }

  function loadPost() {
    var postId = getPostId();
    if (!postId) { showError('ê²Œì‹œê¸€ IDê°€ ì—†ìŠµë‹ˆë‹¤.'); return; }

    var sb = getClient();
    if (!sb) { showError('ë°ì´í„°ë² ì´ìŠ¤ ì„¤ì • ì˜¤ë¥˜'); return; }

    showLoading();

    sb.from('posts')
      .select('id, title, author_name, date, place, type, thumbnail_url, editor_html, created_at')
      .eq('id', postId)
      .eq('approval_stage', 5)
      .single()
      .then(function (res) {
        if (res.error || !res.data) {
          showError('ê²Œì‹œê¸€ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
          return;
        }
        renderPost(res.data);
      });
  }

  /* â”€â”€ ì—°ì† ì´ë¯¸ì§€ â†’ ê°¤ëŸ¬ë¦¬ ë³€í™˜ â”€â”€ */
  function convertConsecutiveImages() {
    var body = document.querySelector('.post-body');
    if (!body) return;

    // 1ë‹¨ê³„: í•˜ë‚˜ì˜ P/DIV ì•ˆì— ì´ë¯¸ì§€ 2ì¥ ì´ìƒì¸ ê²½ìš° ë¨¼ì € ì²˜ë¦¬
    body.querySelectorAll('p, div').forEach(function(container) {
      var imgs = container.querySelectorAll('img');
      if (imgs.length < 2) return;
      // í…ìŠ¤íŠ¸ê°€ ê±°ì˜ ì—†ëŠ” ì´ë¯¸ì§€ ì „ìš© ì»¨í…Œì´ë„ˆì¸ì§€ í™•ì¸
      var clone = container.cloneNode(true);
      clone.querySelectorAll('img').forEach(function(i) { i.remove(); });
      if (clone.textContent.trim().length > 0) return;
      // ì´ë¯¸ì§€ë“¤ì„ ê°œë³„ Pë¡œ í’€ì–´ì„œ êµì²´
      var frag = document.createDocumentFragment();
      imgs.forEach(function(img) {
        var p = document.createElement('p');
        p.appendChild(img.cloneNode(true));
        frag.appendChild(p);
      });
      container.parentNode.replaceChild(frag, container);
    });

    // 2ë‹¨ê³„: ì—°ì† ì´ë¯¸ì§€ ë…¸ë“œ ê·¸ë£¹ ê°ì§€
    var children = Array.from(body.childNodes);
    var groups = [], current = [];

    function isImgNode(node) {
      if (node.nodeType === 1 && node.tagName === 'IMG') return true;
      if (node.nodeType === 1 && (node.tagName === 'P' || node.tagName === 'DIV')) {
        var imgs = node.querySelectorAll('img');
        var text = (node.textContent || '').trim();
        if (imgs.length === 1 && text.length === 0) return true;
      }
      return false;
    }
    function getImg(node) {
      if (node.tagName === 'IMG') return node;
      return node.querySelector('img');
    }
    function flush() {
      if (current.length >= 2) groups.push(current.slice());
      current = [];
    }

    children.forEach(function(node) {
      if (node.nodeType === 3 && node.textContent.trim() === '') return; // skip whitespace
      if (isImgNode(node)) { current.push(node); }
      else { flush(); }
    });
    flush();

    var galleryId = 0;
    groups.forEach(function(nodes) {
      galleryId++;
      var imgs = nodes.map(function(n) {
        var img = getImg(n);
        return { src: img.getAttribute('src') || '', alt: img.getAttribute('alt') || '' };
      });

      var gal = document.createElement('div');
      gal.className = 'img-gallery';
      gal.setAttribute('data-gid', galleryId);

      // toolbar
      var tb = '<div class="gallery-toolbar">';
      tb += '<span class="gallery-count">ğŸ“· ' + imgs.length + 'ì¥</span>';
      tb += '<div class="gallery-modes">';
      tb += '<button class="active" data-mode="slide">ìŠ¬ë¼ì´ë“œ</button>';
      tb += '<button data-mode="grid">ê·¸ë¦¬ë“œ</button>';
      tb += '<button data-mode="list">ë¦¬ìŠ¤íŠ¸</button>';
      tb += '</div></div>';

      // slide view
      var sv = '<div class="gallery-view gallery-slide" data-view="slide">';
      sv += '<div class="slide-track">';
      imgs.forEach(function(im) {
        sv += '<div class="slide-item"><img src="' + im.src + '" alt="' + im.alt + '" loading="lazy"></div>';
      });
      sv += '</div>';
      if (imgs.length > 1) {
        sv += '<button class="slide-nav prev">â—€</button><button class="slide-nav next">â–¶</button>';
      }
      sv += '<div class="slide-dots">';
      imgs.forEach(function(_, i) {
        sv += '<span' + (i === 0 ? ' class="active"' : '') + ' data-idx="' + i + '"></span>';
      });
      sv += '</div></div>';

      // grid view
      var gv = '<div class="gallery-view gallery-grid" data-view="grid" style="display:none">';
      imgs.forEach(function(im) {
        gv += '<img src="' + im.src + '" alt="' + im.alt + '" loading="lazy">';
      });
      gv += '</div>';

      // list view
      var lv = '<div class="gallery-view gallery-list" data-view="list" style="display:none">';
      imgs.forEach(function(im, i) {
        lv += '<div class="gallery-list-item"><img src="' + im.src + '" alt="' + im.alt + '" loading="lazy">';
        lv += '<div class="img-alt">' + (im.alt || ('ì´ë¯¸ì§€ ' + (i + 1))) + '</div></div>';
      });
      lv += '</div>';

      gal.innerHTML = tb + sv + gv + lv;

      // replace original nodes
      nodes[0].parentNode.insertBefore(gal, nodes[0]);
      nodes.forEach(function(n) { n.remove(); });

      // events: mode toggle
      gal.querySelectorAll('.gallery-modes button').forEach(function(btn) {
        btn.addEventListener('click', function() {
          gal.querySelectorAll('.gallery-modes button').forEach(function(b) { b.classList.remove('active'); });
          btn.classList.add('active');
          var mode = btn.getAttribute('data-mode');
          gal.querySelectorAll('.gallery-view').forEach(function(v) {
            v.style.display = v.getAttribute('data-view') === mode ? '' : 'none';
          });
        });
      });

      // events: slide nav
      var track = gal.querySelector('.slide-track');
      var dots = gal.querySelectorAll('.slide-dots span');
      var curSlide = 0;
      function goSlide(idx) {
        if (idx < 0) idx = imgs.length - 1;
        if (idx >= imgs.length) idx = 0;
        curSlide = idx;
        var items = track.querySelectorAll('.slide-item');
        if (items[idx]) items[idx].scrollIntoView({ behavior: 'smooth', block: 'nearest', inline: 'center' });
        dots.forEach(function(d, i) { d.classList.toggle('active', i === idx); });
      }
      var prevBtn = gal.querySelector('.slide-nav.prev');
      var nextBtn = gal.querySelector('.slide-nav.next');
      if (prevBtn) prevBtn.addEventListener('click', function() { goSlide(curSlide - 1); });
      if (nextBtn) nextBtn.addEventListener('click', function() { goSlide(curSlide + 1); });
      dots.forEach(function(dot) {
        dot.addEventListener('click', function() { goSlide(parseInt(dot.getAttribute('data-idx'))); });
      });
      // scroll sync dots
      var scrollTimer;
      track.addEventListener('scroll', function() {
        clearTimeout(scrollTimer);
        scrollTimer = setTimeout(function() {
          var items = track.querySelectorAll('.slide-item');
          var scrollLeft = track.scrollLeft;
          var w = track.offsetWidth;
          var idx = Math.round(scrollLeft / w);
          if (idx >= 0 && idx < imgs.length) {
            curSlide = idx;
            dots.forEach(function(d, i) { d.classList.toggle('active', i === idx); });
          }
        }, 60);
      });

      // events: lightbox on img click â€” ì´ë²¤íŠ¸ ìœ„ì„ ë°©ì‹ (ê·¸ë¦¬ë“œ/ë¦¬ìŠ¤íŠ¸ ëª¨ë“œ í˜¸í™˜)
      gal.addEventListener('click', function(e) {
        var target = e.target;
        if (target.tagName !== 'IMG') return;
        var parentView = target.closest('.gallery-view');
        if (!parentView) return;
        e.stopPropagation();
        var viewImgs = Array.from(parentView.querySelectorAll('img'));
        var clickIdx = viewImgs.indexOf(target);
        if (clickIdx < 0) clickIdx = 0;
        openLightbox(imgs, clickIdx);
      });
    });
  }

  /* â”€â”€ ë¼ì´íŠ¸ë°•ìŠ¤ â”€â”€ */
  var lbOverlay = null;
  var lbImgs = [], lbIdx = 0;
  function ensureLightbox() {
    if (lbOverlay) return;
    lbOverlay = document.createElement('div');
    lbOverlay.className = 'lightbox-overlay';
    lbOverlay.innerHTML = '<button class="lightbox-close">&times;</button>' +
      '<button class="lightbox-nav prev">â—€</button>' +
      '<img src="" alt="">' +
      '<button class="lightbox-nav next">â–¶</button>' +
      '<div class="lightbox-counter"></div>';
    document.body.appendChild(lbOverlay);
    lbOverlay.querySelector('.lightbox-close').addEventListener('click', closeLightbox);
    lbOverlay.addEventListener('click', function(e) { if (e.target === lbOverlay) closeLightbox(); });
    lbOverlay.querySelector('.lightbox-nav.prev').addEventListener('click', function(e) { e.stopPropagation(); lbGo(lbIdx - 1); });
    lbOverlay.querySelector('.lightbox-nav.next').addEventListener('click', function(e) { e.stopPropagation(); lbGo(lbIdx + 1); });
    document.addEventListener('keydown', function(e) {
      if (!lbOverlay.classList.contains('show')) return;
      if (e.key === 'Escape') closeLightbox();
      if (e.key === 'ArrowLeft') lbGo(lbIdx - 1);
      if (e.key === 'ArrowRight') lbGo(lbIdx + 1);
    });
  }
  function openLightbox(imgs, idx) {
    ensureLightbox();
    lbImgs = imgs; lbIdx = idx;
    lbRender();
    lbOverlay.classList.add('show');
    document.body.style.overflow = 'hidden';
  }
  function closeLightbox() {
    if (lbOverlay) lbOverlay.classList.remove('show');
    document.body.style.overflow = '';
  }
  function lbGo(idx) {
    if (idx < 0) idx = lbImgs.length - 1;
    if (idx >= lbImgs.length) idx = 0;
    lbIdx = idx; lbRender();
  }
  function lbRender() {
    var img = lbOverlay.querySelector('img');
    img.src = lbImgs[lbIdx].src;
    img.alt = lbImgs[lbIdx].alt || '';
    lbOverlay.querySelector('.lightbox-counter').textContent = (lbIdx + 1) + ' / ' + lbImgs.length;
    lbOverlay.querySelector('.lightbox-nav.prev').style.display = lbImgs.length > 1 ? '' : 'none';
    lbOverlay.querySelector('.lightbox-nav.next').style.display = lbImgs.length > 1 ? '' : 'none';
  }

  loadPost();
})();
</script>
</body>
</html>
